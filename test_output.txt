  console.log
    üí≥ Payment Processor Mode: MOCK (no real charges)

      at Object.<anonymous> (src/services/paymentProcessor.ts:15:9)

  console.log
    ‚ö†Ô∏è  Email service in development mode - emails will be logged to console

      at new EmailService (src/services/emailService.ts:28:15)

  console.log
    ‚ö†Ô∏è  SMS service in development mode - OTPs will be logged to console

      at new SMSService (src/services/smsService.ts:17:15)

  console.log
       To enable real SMS, set TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, and TWILIO_PHONE_NUMBER

      at new SMSService (src/services/smsService.ts:18:15)

  console.log
    ‚úÖ Loaded acp checkout-request schema

      at ProtocolValidator.loadSchema (src/protocols/protocol-validator.ts:162:21)

  console.log
    ‚úÖ Loaded acp payment-request schema

      at ProtocolValidator.loadSchema (src/protocols/protocol-validator.ts:162:21)

  console.log
    ‚úÖ Registered protocol: acp v2026-01-16

      at ProtocolRegistry.register (src/protocols/protocol-registry.ts:38:13)

  console.log
    ‚úÖ Loaded ucp checkout-request schema

      at ProtocolValidator.loadSchema (src/protocols/protocol-validator.ts:162:21)

  console.log
    ‚úÖ Loaded ucp checkout-response schema

      at ProtocolValidator.loadSchema (src/protocols/protocol-validator.ts:190:21)

  console.log
    ‚úÖ Loaded ucp order schema

      at ProtocolValidator.loadSchema (src/protocols/protocol-validator.ts:190:21)

  console.log
    ‚úÖ Loaded ucp intent schema

      at ProtocolValidator.loadSchema (src/protocols/protocol-validator.ts:175:15)

  console.log
    ‚úÖ Registered protocol: ucp v2026-01-11

      at ProtocolRegistry.register (src/protocols/protocol-registry.ts:38:13)

  console.log
    ‚úÖ Loaded x402 payment-required schema

      at ProtocolValidator.loadSchema (src/protocols/protocol-validator.ts:175:15)

  console.log
    ‚úÖ Loaded x402 payment-payload schema

      at ProtocolValidator.loadSchema (src/protocols/protocol-validator.ts:175:15)

  console.log
    ‚úÖ Registered protocol: x402 v2.0.0

      at ProtocolRegistry.register (src/protocols/protocol-registry.ts:38:13)

  console.log
    [ProtocolRouter] Initialized with protocols: [ 'acp', 'ucp', 'x402' ]

      at ProtocolRouter.initialize (src/protocols/ProtocolRouter.ts:76:13)

  console.log
    üìù Parsed prompt: {
      amount_cents: 2000,
      item_name: 'shoes',
      shipping_speed: 'standard',
      country: 'US',
      quantity: 1,
      currency: 'USD',
      merchant: 'Nike'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_nike_air_max', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_14d8ft9hgxvc

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 2700,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'standard'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 2700,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'standard'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: { risk_score: 0, decision: 'approve', factors: {} }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.error
    Error creating Stripe PaymentIntent: StripeAuthenticationError: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.
        at res.toJSON.then.StripeAPIError.message (D:\HALO-GAUTH-CONVEX\node_modules\stripe\lib\StripeResource.js:214:23)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      type: 'StripeAuthenticationError',
      raw: {
        message: "You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.",
        type: 'invalid_request_error',
        headers: {
          server: 'nginx',
          date: 'Fri, 06 Feb 2026 18:08:54 GMT',
          'content-type': 'application/json',
          'content-length': '342',
          connection: 'keep-alive',
          'access-control-allow-credentials': 'true',
          'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
          'access-control-allow-origin': '*',
          'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
          'access-control-max-age': '300',
          'cache-control': 'no-cache, no-store',
          'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
          vary: 'Origin',
          'www-authenticate': 'Basic realm="Stripe"',
          'x-robots-tag': 'none',
          'x-wc': 'ABHIJ',
          'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
        },
        statusCode: 401,
        requestId: undefined
      },
      rawType: 'invalid_request_error',
      code: undefined,
      doc_url: undefined,
      param: undefined,
      detail: undefined,
      headers: {
        server: 'nginx',
        date: 'Fri, 06 Feb 2026 18:08:54 GMT',
        'content-type': 'application/json',
        'content-length': '342',
        connection: 'keep-alive',
        'access-control-allow-credentials': 'true',
        'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
        'access-control-allow-origin': '*',
        'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
        'access-control-max-age': '300',
        'cache-control': 'no-cache, no-store',
        'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
        vary: 'Origin',
        'www-authenticate': 'Basic realm="Stripe"',
        'x-robots-tag': 'none',
        'x-wc': 'ABHIJ',
        'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
      },
      requestId: undefined,
      statusCode: 401,
      charge: undefined,
      decline_code: undefined,
      payment_intent: undefined,
      payment_method: undefined,
      payment_method_type: undefined,
      setup_intent: undefined,
      source: undefined
    }

    [0m [90m 24 |[39m     [36mreturn[39m paymentIntent[33m;[39m
     [90m 25 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 26 |[39m     console[33m.[39merror([32m'Error creating Stripe PaymentIntent:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 27 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 28 |[39m   }
     [90m 29 |[39m }[33m;[39m[0m

      at createPaymentIntent (src/services/stripeService.ts:26:13)
      at processAgenticPayment (src/controllers/agenticPaymentController.ts:91:29)

  console.log
    üìù Parsed prompt: {
      amount_cents: 5000,
      item_name: 'jacket',
      shipping_speed: 'express',
      country: 'US',
      quantity: 1,
      currency: 'USD',
      merchant: 'Amazon'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_jacket', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_91u5y5g4f5q

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 7000,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'express'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 7000,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'express'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 20,
      decision: 'approve',
      factors: { elevated_value: true, express_shipping: true }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.error
    Error creating Stripe PaymentIntent: StripeAuthenticationError: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.
        at res.toJSON.then.StripeAPIError.message (D:\HALO-GAUTH-CONVEX\node_modules\stripe\lib\StripeResource.js:214:23)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      type: 'StripeAuthenticationError',
      raw: {
        message: "You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.",
        type: 'invalid_request_error',
        headers: {
          server: 'nginx',
          date: 'Fri, 06 Feb 2026 18:08:54 GMT',
          'content-type': 'application/json',
          'content-length': '342',
          connection: 'keep-alive',
          'access-control-allow-credentials': 'true',
          'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
          'access-control-allow-origin': '*',
          'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
          'access-control-max-age': '300',
          'cache-control': 'no-cache, no-store',
          'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
          vary: 'Origin',
          'www-authenticate': 'Basic realm="Stripe"',
          'x-robots-tag': 'none',
          'x-wc': 'ABHIJ',
          'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
        },
        statusCode: 401,
        requestId: undefined
      },
      rawType: 'invalid_request_error',
      code: undefined,
      doc_url: undefined,
      param: undefined,
      detail: undefined,
      headers: {
        server: 'nginx',
        date: 'Fri, 06 Feb 2026 18:08:54 GMT',
        'content-type': 'application/json',
        'content-length': '342',
        connection: 'keep-alive',
        'access-control-allow-credentials': 'true',
        'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
        'access-control-allow-origin': '*',
        'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
        'access-control-max-age': '300',
        'cache-control': 'no-cache, no-store',
        'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
        vary: 'Origin',
        'www-authenticate': 'Basic realm="Stripe"',
        'x-robots-tag': 'none',
        'x-wc': 'ABHIJ',
        'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
      },
      requestId: undefined,
      statusCode: 401,
      charge: undefined,
      decline_code: undefined,
      payment_intent: undefined,
      payment_method: undefined,
      payment_method_type: undefined,
      setup_intent: undefined,
      source: undefined
    }

    [0m [90m 24 |[39m     [36mreturn[39m paymentIntent[33m;[39m
     [90m 25 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 26 |[39m     console[33m.[39merror([32m'Error creating Stripe PaymentIntent:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 27 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 28 |[39m   }
     [90m 29 |[39m }[33m;[39m[0m

      at createPaymentIntent (src/services/stripeService.ts:26:13)
      at processAgenticPayment (src/controllers/agenticPaymentController.ts:91:29)

  console.log
    üìù Parsed prompt: {
      amount_cents: 10000,
      item_name: 'item',
      shipping_speed: 'express',
      country: 'FR',
      quantity: 1,
      currency: 'USD',
      merchant: undefined
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_item', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_bn9d7jbcw4q

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 12500,
      currency: 'usd',
      country: 'FR',
      payment_provider: 'stripe',
      shipping_speed: 'express'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 12500,
        currency: 'usd',
        country: 'FR',
        provider: 'stripe',
        shipping_speed: 'express'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 50,
      decision: 'challenge',
      factors: { moderate_value: true, international: true, express_shipping: true }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.log
    üìù Parsed prompt: {
      amount_cents: 3000,
      item_name: 'shirts',
      shipping_speed: 'standard',
      country: 'US',
      quantity: 3,
      currency: 'USD',
      merchant: 'eBay'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_shirts', quantity: 3 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_ovi5iuwf1cr

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 3800,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'standard'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 3800,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'standard'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: { risk_score: 0, decision: 'approve', factors: {} }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.error
    Error creating Stripe PaymentIntent: StripeAuthenticationError: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.
        at res.toJSON.then.StripeAPIError.message (D:\HALO-GAUTH-CONVEX\node_modules\stripe\lib\StripeResource.js:214:23)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      type: 'StripeAuthenticationError',
      raw: {
        message: "You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.",
        type: 'invalid_request_error',
        headers: {
          server: 'nginx',
          date: 'Fri, 06 Feb 2026 18:08:54 GMT',
          'content-type': 'application/json',
          'content-length': '342',
          connection: 'keep-alive',
          'access-control-allow-credentials': 'true',
          'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
          'access-control-allow-origin': '*',
          'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
          'access-control-max-age': '300',
          'cache-control': 'no-cache, no-store',
          'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
          vary: 'Origin',
          'www-authenticate': 'Basic realm="Stripe"',
          'x-robots-tag': 'none',
          'x-wc': 'ABHIJ',
          'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
        },
        statusCode: 401,
        requestId: undefined
      },
      rawType: 'invalid_request_error',
      code: undefined,
      doc_url: undefined,
      param: undefined,
      detail: undefined,
      headers: {
        server: 'nginx',
        date: 'Fri, 06 Feb 2026 18:08:54 GMT',
        'content-type': 'application/json',
        'content-length': '342',
        connection: 'keep-alive',
        'access-control-allow-credentials': 'true',
        'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
        'access-control-allow-origin': '*',
        'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
        'access-control-max-age': '300',
        'cache-control': 'no-cache, no-store',
        'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
        vary: 'Origin',
        'www-authenticate': 'Basic realm="Stripe"',
        'x-robots-tag': 'none',
        'x-wc': 'ABHIJ',
        'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
      },
      requestId: undefined,
      statusCode: 401,
      charge: undefined,
      decline_code: undefined,
      payment_intent: undefined,
      payment_method: undefined,
      payment_method_type: undefined,
      setup_intent: undefined,
      source: undefined
    }

    [0m [90m 24 |[39m     [36mreturn[39m paymentIntent[33m;[39m
     [90m 25 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 26 |[39m     console[33m.[39merror([32m'Error creating Stripe PaymentIntent:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 27 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 28 |[39m   }
     [90m 29 |[39m }[33m;[39m[0m

      at createPaymentIntent (src/services/stripeService.ts:26:13)
      at processAgenticPayment (src/controllers/agenticPaymentController.ts:91:29)

  console.log
    üìù Parsed prompt: {
      amount_cents: 5000,
      item_name: 'headphones',
      shipping_speed: 'standard',
      country: 'US',
      quantity: 1,
      currency: 'USD',
      merchant: 'Best'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_headphones', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_cj1epstha3

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 6000,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'standard'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 6000,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'standard'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 10,
      decision: 'approve',
      factors: { elevated_value: true }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.error
    Error creating Stripe PaymentIntent: StripeAuthenticationError: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.
        at res.toJSON.then.StripeAPIError.message (D:\HALO-GAUTH-CONVEX\node_modules\stripe\lib\StripeResource.js:214:23)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      type: 'StripeAuthenticationError',
      raw: {
        message: "You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.",
        type: 'invalid_request_error',
        headers: {
          server: 'nginx',
          date: 'Fri, 06 Feb 2026 18:08:55 GMT',
          'content-type': 'application/json',
          'content-length': '342',
          connection: 'keep-alive',
          'access-control-allow-credentials': 'true',
          'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
          'access-control-allow-origin': '*',
          'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
          'access-control-max-age': '300',
          'cache-control': 'no-cache, no-store',
          'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
          vary: 'Origin',
          'www-authenticate': 'Basic realm="Stripe"',
          'x-robots-tag': 'none',
          'x-wc': 'ABHIJ',
          'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
        },
        statusCode: 401,
        requestId: undefined
      },
      rawType: 'invalid_request_error',
      code: undefined,
      doc_url: undefined,
      param: undefined,
      detail: undefined,
      headers: {
        server: 'nginx',
        date: 'Fri, 06 Feb 2026 18:08:55 GMT',
        'content-type': 'application/json',
        'content-length': '342',
        connection: 'keep-alive',
        'access-control-allow-credentials': 'true',
        'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
        'access-control-allow-origin': '*',
        'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
        'access-control-max-age': '300',
        'cache-control': 'no-cache, no-store',
        'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
        vary: 'Origin',
        'www-authenticate': 'Basic realm="Stripe"',
        'x-robots-tag': 'none',
        'x-wc': 'ABHIJ',
        'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
      },
      requestId: undefined,
      statusCode: 401,
      charge: undefined,
      decline_code: undefined,
      payment_intent: undefined,
      payment_method: undefined,
      payment_method_type: undefined,
      setup_intent: undefined,
      source: undefined
    }

    [0m [90m 24 |[39m     [36mreturn[39m paymentIntent[33m;[39m
     [90m 25 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 26 |[39m     console[33m.[39merror([32m'Error creating Stripe PaymentIntent:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 27 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 28 |[39m   }
     [90m 29 |[39m }[33m;[39m[0m

      at createPaymentIntent (src/services/stripeService.ts:26:13)
      at processAgenticPayment (src/controllers/agenticPaymentController.ts:91:29)

  console.log
    üìù Parsed prompt: {
      amount_cents: 5000,
      item_name: 'headphones',
      shipping_speed: 'standard',
      country: 'GB',
      quantity: 1,
      currency: 'USD',
      merchant: undefined
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_headphones', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_93qspnfadv

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 6000,
      currency: 'usd',
      country: 'GB',
      payment_provider: 'stripe',
      shipping_speed: 'standard'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 6000,
        currency: 'usd',
        country: 'GB',
        provider: 'stripe',
        shipping_speed: 'standard'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 30,
      decision: 'challenge',
      factors: { elevated_value: true, international: true }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.log
    üìù Parsed prompt: {
      amount_cents: 1500,
      item_name: 'item',
      shipping_speed: 'standard',
      country: 'US',
      quantity: 1,
      currency: 'USD',
      merchant: undefined
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_item', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_3iuju49yuon

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 2150,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'standard'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 2150,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'standard'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: { risk_score: 0, decision: 'approve', factors: {} }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.error
    Error creating Stripe PaymentIntent: StripeAuthenticationError: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.
        at res.toJSON.then.StripeAPIError.message (D:\HALO-GAUTH-CONVEX\node_modules\stripe\lib\StripeResource.js:214:23)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      type: 'StripeAuthenticationError',
      raw: {
        message: "You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.",
        type: 'invalid_request_error',
        headers: {
          server: 'nginx',
          date: 'Fri, 06 Feb 2026 18:08:55 GMT',
          'content-type': 'application/json',
          'content-length': '342',
          connection: 'keep-alive',
          'access-control-allow-credentials': 'true',
          'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
          'access-control-allow-origin': '*',
          'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
          'access-control-max-age': '300',
          'cache-control': 'no-cache, no-store',
          'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
          vary: 'Origin',
          'www-authenticate': 'Basic realm="Stripe"',
          'x-robots-tag': 'none',
          'x-wc': 'ABHIJ',
          'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
        },
        statusCode: 401,
        requestId: undefined
      },
      rawType: 'invalid_request_error',
      code: undefined,
      doc_url: undefined,
      param: undefined,
      detail: undefined,
      headers: {
        server: 'nginx',
        date: 'Fri, 06 Feb 2026 18:08:55 GMT',
        'content-type': 'application/json',
        'content-length': '342',
        connection: 'keep-alive',
        'access-control-allow-credentials': 'true',
        'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
        'access-control-allow-origin': '*',
        'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
        'access-control-max-age': '300',
        'cache-control': 'no-cache, no-store',
        'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
        vary: 'Origin',
        'www-authenticate': 'Basic realm="Stripe"',
        'x-robots-tag': 'none',
        'x-wc': 'ABHIJ',
        'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
      },
      requestId: undefined,
      statusCode: 401,
      charge: undefined,
      decline_code: undefined,
      payment_intent: undefined,
      payment_method: undefined,
      payment_method_type: undefined,
      setup_intent: undefined,
      source: undefined
    }

    [0m [90m 24 |[39m     [36mreturn[39m paymentIntent[33m;[39m
     [90m 25 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 26 |[39m     console[33m.[39merror([32m'Error creating Stripe PaymentIntent:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 27 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 28 |[39m   }
     [90m 29 |[39m }[33m;[39m[0m

      at createPaymentIntent (src/services/stripeService.ts:26:13)
      at processAgenticPayment (src/controllers/agenticPaymentController.ts:91:29)

  console.log
    üìù Parsed prompt: {
      amount_cents: 10000,
      item_name: 'laptop',
      shipping_speed: 'express',
      country: 'US',
      quantity: 1,
      currency: 'USD',
      merchant: undefined
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_gaming_laptop_pro', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_ujace3qknt

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 12500,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'express'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 12500,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'express'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 30,
      decision: 'challenge',
      factors: { moderate_value: true, express_shipping: true }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.log
    üìù Parsed prompt: {
      amount_cents: 9900,
      item_name: 'sneakers',
      shipping_speed: 'express',
      country: 'US',
      quantity: 1,
      currency: 'USD',
      merchant: 'Nike'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_sneakers', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_zxbc238sqo

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 12390,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'express'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 12390,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'express'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 30,
      decision: 'challenge',
      factors: { moderate_value: true, express_shipping: true }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.log
    üìù Parsed prompt: {
      amount_cents: 9999,
      item_name: 'item',
      shipping_speed: 'standard',
      country: 'US',
      quantity: 1,
      currency: 'USD',
      merchant: undefined
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_item', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_5h3w87l4vfs

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 11499,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'standard'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 11499,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'standard'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 20,
      decision: 'approve',
      factors: { moderate_value: true }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.error
    Error creating Stripe PaymentIntent: StripeAuthenticationError: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.
        at res.toJSON.then.StripeAPIError.message (D:\HALO-GAUTH-CONVEX\node_modules\stripe\lib\StripeResource.js:214:23)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      type: 'StripeAuthenticationError',
      raw: {
        message: "You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.",
        type: 'invalid_request_error',
        headers: {
          server: 'nginx',
          date: 'Fri, 06 Feb 2026 18:08:55 GMT',
          'content-type': 'application/json',
          'content-length': '342',
          connection: 'keep-alive',
          'access-control-allow-credentials': 'true',
          'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
          'access-control-allow-origin': '*',
          'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
          'access-control-max-age': '300',
          'cache-control': 'no-cache, no-store',
          'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
          vary: 'Origin',
          'www-authenticate': 'Basic realm="Stripe"',
          'x-robots-tag': 'none',
          'x-wc': 'ABHIJ',
          'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
        },
        statusCode: 401,
        requestId: undefined
      },
      rawType: 'invalid_request_error',
      code: undefined,
      doc_url: undefined,
      param: undefined,
      detail: undefined,
      headers: {
        server: 'nginx',
        date: 'Fri, 06 Feb 2026 18:08:55 GMT',
        'content-type': 'application/json',
        'content-length': '342',
        connection: 'keep-alive',
        'access-control-allow-credentials': 'true',
        'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
        'access-control-allow-origin': '*',
        'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
        'access-control-max-age': '300',
        'cache-control': 'no-cache, no-store',
        'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
        vary: 'Origin',
        'www-authenticate': 'Basic realm="Stripe"',
        'x-robots-tag': 'none',
        'x-wc': 'ABHIJ',
        'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
      },
      requestId: undefined,
      statusCode: 401,
      charge: undefined,
      decline_code: undefined,
      payment_intent: undefined,
      payment_method: undefined,
      payment_method_type: undefined,
      setup_intent: undefined,
      source: undefined
    }

    [0m [90m 24 |[39m     [36mreturn[39m paymentIntent[33m;[39m
     [90m 25 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 26 |[39m     console[33m.[39merror([32m'Error creating Stripe PaymentIntent:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 27 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 28 |[39m   }
     [90m 29 |[39m }[33m;[39m[0m

      at createPaymentIntent (src/services/stripeService.ts:26:13)
      at processAgenticPayment (src/controllers/agenticPaymentController.ts:91:29)

  console.log
    üìù Parsed prompt: {
      amount_cents: 500000,
      item_name: 'laptop',
      shipping_speed: 'express',
      country: 'FR',
      quantity: 1,
      currency: 'USD',
      merchant: undefined
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_gaming_laptop_pro', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_fs462vd92c

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 551500,
      currency: 'usd',
      country: 'FR',
      payment_provider: 'stripe',
      shipping_speed: 'express'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 551500,
        currency: 'usd',
        country: 'FR',
        provider: 'stripe',
        shipping_speed: 'express'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 80,
      decision: 'block',
      factors: {
        very_high_value: true,
        international: true,
        express_shipping: true
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.log
    üìù Parsed prompt: {
      amount_cents: 5000,
      item_name: 'item',
      shipping_speed: 'standard',
      country: 'US',
      quantity: 1,
      currency: 'USD',
      merchant: undefined
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_item', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_vmjrdsrns1

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 6000,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'standard'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 6000,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'standard'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 10,
      decision: 'approve',
      factors: { elevated_value: true }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.error
    Error creating Stripe PaymentIntent: StripeAuthenticationError: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.
        at res.toJSON.then.StripeAPIError.message (D:\HALO-GAUTH-CONVEX\node_modules\stripe\lib\StripeResource.js:214:23)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      type: 'StripeAuthenticationError',
      raw: {
        message: "You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.",
        type: 'invalid_request_error',
        headers: {
          server: 'nginx',
          date: 'Fri, 06 Feb 2026 18:08:55 GMT',
          'content-type': 'application/json',
          'content-length': '342',
          connection: 'keep-alive',
          'access-control-allow-credentials': 'true',
          'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
          'access-control-allow-origin': '*',
          'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
          'access-control-max-age': '300',
          'cache-control': 'no-cache, no-store',
          'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
          vary: 'Origin',
          'www-authenticate': 'Basic realm="Stripe"',
          'x-robots-tag': 'none',
          'x-wc': 'ABHIJ',
          'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
        },
        statusCode: 401,
        requestId: undefined
      },
      rawType: 'invalid_request_error',
      code: undefined,
      doc_url: undefined,
      param: undefined,
      detail: undefined,
      headers: {
        server: 'nginx',
        date: 'Fri, 06 Feb 2026 18:08:55 GMT',
        'content-type': 'application/json',
        'content-length': '342',
        connection: 'keep-alive',
        'access-control-allow-credentials': 'true',
        'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
        'access-control-allow-origin': '*',
        'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
        'access-control-max-age': '300',
        'cache-control': 'no-cache, no-store',
        'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
        vary: 'Origin',
        'www-authenticate': 'Basic realm="Stripe"',
        'x-robots-tag': 'none',
        'x-wc': 'ABHIJ',
        'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
      },
      requestId: undefined,
      statusCode: 401,
      charge: undefined,
      decline_code: undefined,
      payment_intent: undefined,
      payment_method: undefined,
      payment_method_type: undefined,
      setup_intent: undefined,
      source: undefined
    }

    [0m [90m 24 |[39m     [36mreturn[39m paymentIntent[33m;[39m
     [90m 25 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 26 |[39m     console[33m.[39merror([32m'Error creating Stripe PaymentIntent:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 27 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 28 |[39m   }
     [90m 29 |[39m }[33m;[39m[0m

      at createPaymentIntent (src/services/stripeService.ts:26:13)
      at processAgenticPayment (src/controllers/agenticPaymentController.ts:91:29)

  console.log
    üìù Parsed prompt: {
      amount_cents: 5000,
      item_name: 'item',
      shipping_speed: 'standard',
      country: 'US',
      quantity: 1,
      currency: 'USD',
      merchant: undefined
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:60:13)

  console.log
    üì§ ACP CREATE REQUEST: {
      items: [ { id: 'sku_item', quantity: 1 } ],
      agent_capabilities: {
        interventions: {
          supported: [Array],
          max_redirects: 1,
          redirect_context: 'in_app',
          max_interaction_depth: 2,
          display_context: 'webview'
        },
        features: { async_completion: true, session_persistence: true },
        payment_methods: [ 'card' ]
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:64:13)

  console.log
    üì• ACP CREATE RESPONSE: checkout_session_vsb3juyzwxp

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:74:13)

  console.log
    üîç Halo parsed ACP data: {
      total_cents: 6000,
      currency: 'usd',
      country: 'US',
      payment_provider: 'stripe',
      shipping_speed: 'standard'
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:78:13)

  console.log
    ‚ú® Normalized payload: {
      halo_normalized: {
        total_cents: 6000,
        currency: 'usd',
        country: 'US',
        provider: 'stripe',
        shipping_speed: 'standard'
      }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:82:13)

  console.log
    ‚ö†Ô∏è Risk assessment: {
      risk_score: 10,
      decision: 'approve',
      factors: { elevated_value: true }
    }

      at processAgenticPayment (src/controllers/agenticPaymentController.ts:86:13)

  console.error
    Error creating Stripe PaymentIntent: StripeAuthenticationError: You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.
        at res.toJSON.then.StripeAPIError.message (D:\HALO-GAUTH-CONVEX\node_modules\stripe\lib\StripeResource.js:214:23)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      type: 'StripeAuthenticationError',
      raw: {
        message: "You did not provide an API key. You need to provide your API key in the Authorization header, using Bearer auth (e.g. 'Authorization: Bearer YOUR_SECRET_KEY'). See https://stripe.com/docs/api#authentication for details, or we can help at https://support.stripe.com/.",
        type: 'invalid_request_error',
        headers: {
          server: 'nginx',
          date: 'Fri, 06 Feb 2026 18:08:55 GMT',
          'content-type': 'application/json',
          'content-length': '342',
          connection: 'keep-alive',
          'access-control-allow-credentials': 'true',
          'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
          'access-control-allow-origin': '*',
          'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
          'access-control-max-age': '300',
          'cache-control': 'no-cache, no-store',
          'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
          vary: 'Origin',
          'www-authenticate': 'Basic realm="Stripe"',
          'x-robots-tag': 'none',
          'x-wc': 'ABHIJ',
          'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
        },
        statusCode: 401,
        requestId: undefined
      },
      rawType: 'invalid_request_error',
      code: undefined,
      doc_url: undefined,
      param: undefined,
      detail: undefined,
      headers: {
        server: 'nginx',
        date: 'Fri, 06 Feb 2026 18:08:55 GMT',
        'content-type': 'application/json',
        'content-length': '342',
        connection: 'keep-alive',
        'access-control-allow-credentials': 'true',
        'access-control-allow-methods': 'GET, HEAD, PUT, PATCH, POST, DELETE',
        'access-control-allow-origin': '*',
        'access-control-expose-headers': 'Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required',
        'access-control-max-age': '300',
        'cache-control': 'no-cache, no-store',
        'content-security-policy': "base-uri 'none'; default-src 'none'; form-action 'none'; frame-ancestors 'none'; upgrade-insecure-requests",
        vary: 'Origin',
        'www-authenticate': 'Basic realm="Stripe"',
        'x-robots-tag': 'none',
        'x-wc': 'ABHIJ',
        'strict-transport-security': 'max-age=63072000; includeSubDomains; preload'
      },
      requestId: undefined,
      statusCode: 401,
      charge: undefined,
      decline_code: undefined,
      payment_intent: undefined,
      payment_method: undefined,
      payment_method_type: undefined,
      setup_intent: undefined,
      source: undefined
    }

    [0m [90m 24 |[39m     [36mreturn[39m paymentIntent[33m;[39m
     [90m 25 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 26 |[39m     console[33m.[39merror([32m'Error creating Stripe PaymentIntent:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 27 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 28 |[39m   }
     [90m 29 |[39m }[33m;[39m[0m

      at createPaymentIntent (src/services/stripeService.ts:26:13)
      at processAgenticPayment (src/controllers/agenticPaymentController.ts:91:29)

FAIL tests/integration/agenticPayment.test.ts (10.761 s)
  Agentic Payment Controller Integration Tests
    POST /halo/process-payment
      ‚àö should process simple payment prompt and return APPROVE (450 ms)
      √ó should process payment with express shipping (82 ms)
      √ó should process international payment (16 ms)
      ‚àö should process payment with multiple items (72 ms)
      ‚àö should extract merchant correctly (74 ms)
      ‚àö should extract country correctly (22 ms)
      ‚àö should return 400 for missing prompt (9 ms)
      ‚àö should return 400 for invalid prompt type (8 ms)
      ‚àö should attempt to create payment intent for APPROVE decisions (95 ms)
      ‚àö should not create payment intent for CHALLENGE decisions (24 ms)
      ‚àö should return normalized payload with correct structure (28 ms)
      ‚àö should handle decimal amounts (81 ms)
      ‚àö should handle large amounts (16 ms)
      ‚àö should generate unique checkout session IDs (152 ms)

  ‚óè Agentic Payment Controller Integration Tests ‚Ä∫ POST /halo/process-payment ‚Ä∫ should process payment with express shipping

    expect(received).toBe(expected) // Object.is equality

    Expected: "challenge"
    Received: "approve"

    [0m [90m 31 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 32 |[39m       expect(response[33m.[39mbody[33m.[39mnormalized_payload[33m.[39mhalo_normalized[33m.[39mshipping_speed)[33m.[39mtoBe([32m'express'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 33 |[39m       expect(response[33m.[39mbody[33m.[39mdecision)[33m.[39mtoBe([32m'challenge'[39m)[33m;[39m [90m// $50 + express = score 40[39m
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 34 |[39m       expect(response[33m.[39mbody[33m.[39mrisk_score)[33m.[39mtoBe([35m40[39m)[33m;[39m
     [90m 35 |[39m     })[33m;[39m
     [90m 36 |[39m[0m

      at Object.<anonymous> (tests/integration/agenticPayment.test.ts:33:38)

  ‚óè Agentic Payment Controller Integration Tests ‚Ä∫ POST /halo/process-payment ‚Ä∫ should process international payment

    expect(received).toBe(expected) // Object.is equality

    Expected: "block"
    Received: "challenge"

    [0m [90m 45 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 46 |[39m       expect(response[33m.[39mbody[33m.[39mnormalized_payload[33m.[39mhalo_normalized[33m.[39mcountry)[33m.[39mtoBe([32m'FR'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 47 |[39m       expect(response[33m.[39mbody[33m.[39mdecision)[33m.[39mtoBe([32m'block'[39m)[33m;[39m [90m// $100 + FR + express = score 60[39m
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 48 |[39m       expect(response[33m.[39mbody[33m.[39mrisk_score)[33m.[39mtoBe([35m60[39m)[33m;[39m
     [90m 49 |[39m     })[33m;[39m
     [90m 50 |[39m[0m

      at Object.<anonymous> (tests/integration/agenticPayment.test.ts:47:38)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 12 passed, 14 total
Snapshots:   0 total
Time:        11.35 s
Ran all test suites matching /tests\\integration\\agenticPayment.test.ts/i.
